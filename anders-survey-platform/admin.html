<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anders Admin Panel</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        /* -------------------------------------- */
        /* 1. ì»¤ìŠ¤í„°ë§ˆì´ì§• ë³€ìˆ˜ ì„¤ì • */
        /* -------------------------------------- */
        :root {
            --primary-color: #0099ff; /* ê´€ë¦¬ì ì‹œìŠ¤í…œ ì£¼ ìƒ‰ìƒ */
            --secondary-color: #f7f7f7; /* ë°°ê²½ìƒ‰ */
            font-family: 'Inter', sans-serif;
        }
        
        /* 2. ê´€ë¦¬ì ë ˆì´ì•„ì›ƒ ìŠ¤íƒ€ì¼ */
        .admin-content-area {
            min-height: calc(100vh - 64px); /* í—¤ë” ë†’ì´ë§Œí¼ ì œì™¸ */
            background-color: var(--secondary-color);
        }
        /* í˜„ì¬ í™œì„±í™”ëœ íƒ­ ìŠ¤íƒ€ì¼ */
        .admin-nav-item.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
        }
        /* ì§ˆë¬¸ ë¹Œë” ìŠ¤íƒ€ì¼ */
        .question-block.selected {
            border: 2px solid var(--primary-color);
            background-color: #e0f2ff; /* blue-50 */
        }
        /* ì¸ì¦ë˜ì§€ ì•Šì•˜ì„ ë•Œ ë³¸ë¬¸ ìˆ¨ê¸°ê¸° */
        body.no-auth .admin-nav-item { display: none !important; }
    </style>
</head>
<body class="bg-white">

    <header class="bg-white shadow-md sticky top-0 z-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <span class="text-2xl font-bold text-gray-800" style="color: var(--primary-color);">Anders Admin</span>
                </div>
                <nav id="admin-nav" class="flex space-x-6 h-full" style="display: none;">
                    <a href="#" onclick="renderAdminView('export')" class="admin-nav-item flex items-center px-1 pt-1 text-sm font-medium text-gray-500 active">
                        ì‘ë‹µ ë°ì´í„° ì¶”ì¶œ (DB)
                    </a>
                    <a href="#" onclick="renderAdminView('builder')" class="admin-nav-item flex items-center px-1 pt-1 text-sm font-medium text-gray-500">
                        ì„¤ë¬¸ ìƒì„± ë° ê´€ë¦¬
                    </a>
                    <a href="#" onclick="renderAdminView('custom')" class="admin-nav-item flex items-center px-1 pt-1 text-sm font-medium text-gray-500">
                        ğŸ¨ ë¸Œëœë“œ/ì»¤ìŠ¤í„°ë§ˆì´ì§•
                    </a>
                </nav>
                <div class="flex items-center">
                    <button id="logout-button" onclick="handleAdminLogout()" class="text-gray-600 hover:text-gray-800 text-sm" style="display: none;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
        </div>
    </header>

    <main class="admin-content-area max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="mb-8 h-40 bg-gray-200 rounded-xl shadow-lg flex items-center justify-center text-gray-600 font-semibold text-xl">
             [Admin Main Key Visual Image Area]
        </div>
        <div id="admin-content-container">
            <div class="text-center py-10 text-gray-500">ì¸ì¦ ìƒíƒœë¥¼ í™•ì¸ ì¤‘ì…ë‹ˆë‹¤...</div>
        </div>
    </main>

    <script>
        const adminContentContainer = document.getElementById('admin-content-container');
        const adminNav = document.getElementById('admin-nav');
        const logoutButton = document.getElementById('logout-button');
        
        // ì¸ì¦ ê´€ë ¨ ìƒìˆ˜
        const API_LOGIN_URL = `${window.location.origin.replace(/\/$/, '')}/api/users/login`;
        const ADMIN_TOKEN_KEY = 'adminToken'; 

        // ìƒíƒœ ê´€ë¦¬
        let currentAdminView = 'export';
        let selectedQuestionElement = null;

        // ===============================================
        // A. ì¸ì¦ ë° ë¡œê·¸ì¸ ê´€ë ¨ í•¨ìˆ˜
        // ===============================================

        /**
         * 1. ê´€ë¦¬ì ë¡œê·¸ì¸ ì²˜ë¦¬
         */
        async function handleAdminLogin(username, password) {
            try {
                const response = await fetch(API_LOGIN_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (response.ok && data.token) {
                    // 1. í† í° ì €ì¥ (ì‹¤ì œë¡œëŠ” ë°±ì—”ë“œì—ì„œ 'role: ADMIN'ì„ í™•ì¸í•´ì•¼ í•¨)
                    localStorage.setItem(ADMIN_TOKEN_KEY, data.token);
                    
                    // 2. í˜ì´ì§€ ë¦¬ë¡œë“œí•˜ì—¬ ì¸ì¦ ì„±ê³µ ë·° ë Œë”ë§
                    window.location.reload(); 
                    return { success: true };
                } else {
                    return { success: false, message: data.message || "ë¡œê·¸ì¸ ì •ë³´ê°€ ì˜¬ë°”ë¥´ì§€ ì•Šê±°ë‚˜ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤." };
                }
            } catch (error) {
                console.error("Login API Error:", error);
                return { success: false, message: "ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. (API í™•ì¸ í•„ìš”)" };
            }
        }

        /**
         * 2. ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬
         */
        function handleAdminLogout() {
            if (confirm("ì •ë§ë¡œ ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) {
                localStorage.removeItem(ADMIN_TOKEN_KEY);
                // ë¡œê·¸ì•„ì›ƒ í›„ ë¡œê·¸ì¸ ë·° ë Œë”ë§
                window.location.reload();
            }
        }

        /**
         * 3. ë¡œê·¸ì¸ ë·° ë Œë”ë§
         */
        function renderLoginView() {
            adminContentContainer.innerHTML = `
                <div class="flex items-center justify-center min-h-[70vh]">
                    <div class="bg-white p-10 rounded-xl shadow-2xl w-full max-w-sm">
                        <h2 class="text-3xl font-bold text-gray-800 text-center mb-6">ğŸ”‘ ê´€ë¦¬ì ë¡œê·¸ì¸</h2>
                        <div id="login-error-message" class="text-red-600 text-sm mb-4 hidden"></div>
                        <form id="admin-login-form" class="space-y-4">
                            <div>
                                <label class="block text-gray-700 font-medium mb-1">ì•„ì´ë””</label>
                                <input type="text" id="login-username" value="admin" class="w-full p-3 border rounded-lg focus:ring-blue-500" required>
                            </div>
                            <div>
                                <label class="block text-gray-700 font-medium mb-1">ë¹„ë°€ë²ˆí˜¸</label>
                                <input type="password" id="login-password" value="1234" class="w-full p-3 border rounded-lg focus:ring-blue-500" required>
                            </div>
                            <button type="submit" 
                                    class="w-full py-3 text-white font-bold rounded-lg transition duration-150"
                                    style="background-color: var(--primary-color);">
                                ë¡œê·¸ì¸
                            </button>
                        </form>
                    </div>
                </div>
            `;

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë¶€ì°©
            document.getElementById('admin-login-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('login-username').value;
                const password = document.getElementById('login-password').value;
                const errorDiv = document.getElementById('login-error-message');
                
                const result = await handleAdminLogin(username, password);
                
                if (!result.success) {
                    errorDiv.textContent = result.message;
                    errorDiv.classList.remove('hidden');
                }
            });
        }

        /**
         * 4. Admin í˜ì´ì§€ ì´ˆê¸° ì§„ì… ì‹œ ì¸ì¦ ìƒíƒœ í™•ì¸ ë° ë·° ë¶„ê¸°
         */
        function checkAdminAuth() {
            const token = localStorage.getItem(ADMIN_TOKEN_KEY);
            
            if (token) {
                // í† í°ì´ ìˆì„ ê²½ìš°, ê´€ë¦¬ì ë·° ë¡œë“œ (ì‹¤ì œë¡œëŠ” ì—¬ê¸°ì„œ í† í° ìœ íš¨ì„± ê²€ì¦ API í˜¸ì¶œ í•„ìš”)
                document.body.classList.remove('no-auth');
                adminNav.style.display = 'flex';
                logoutButton.style.display = 'block';
                renderAdminView('export');
            } else {
                // í† í°ì´ ì—†ìœ¼ë©´ ë¡œê·¸ì¸ ë·° ë Œë”ë§
                document.body.classList.add('no-auth');
                renderLoginView();
            }
        }


        // ===============================================
        // B. ê´€ë¦¬ì ë·° ë Œë”ë§ ë° ê¸°ëŠ¥ í•¨ìˆ˜ (ê¸°ì¡´ ë¡œì§ ìœ ì§€)
        // ===============================================

        function renderAdminView(view) {
            currentAdminView = view;
            
            // ë„¤ë¹„ê²Œì´ì…˜ í•˜ì´ë¼ì´íŠ¸ ì—…ë°ì´íŠ¸
            document.querySelectorAll('.admin-nav-item').forEach(el => {
                el.classList.remove('active');
            });
            document.querySelector(`[onclick="renderAdminView('${view}')"]`).classList.add('active');

            if (view === 'export') {
                renderDataExportView();
            } else if (view === 'builder') {
                renderSurveyBuilderView();
            } else if (view === 'custom') {
                renderCustomizationView();
            }
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì¸ì¦ í™•ì¸ í•¨ìˆ˜ í˜¸ì¶œ
        document.addEventListener('DOMContentLoaded', () => {
            checkAdminAuth();
        });
        
        // --- 2. ì‘ë‹µ ë°ì´í„° ì¶”ì¶œ (DB í™•ë³´) ë·° ---
        function renderDataExportView() {
            // ... (ì´ì „ì˜ renderDataExportView HTML ë‚´ìš© ê·¸ëŒ€ë¡œ ì‚½ì…)
            adminContentContainer.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ“Š ì‘ë‹µ ë°ì´í„° ì¶”ì¶œ ë° ê´€ë¦¬</h1>
                
                <div class="bg-white p-6 shadow-xl rounded-xl space-y-6">
                    
                    <div class="flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 border-b pb-4">
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì„¤ë¬¸ ì„ íƒ</label>
                            <select class="w-full p-2 border border-gray-300 rounded-lg">
                                <option>ì„¤ë¬¸ ID 1: 2024ë…„ ì‹ ì œí’ˆ ì´ë²¤íŠ¸ (452 ì‘ë‹µ)</option>
                                <option>ì„¤ë¬¸ ID 2: ë§Œì¡±ë„ ì¡°ì‚¬ (120 ì‘ë‹µ)</option>
                            </select>
                        </div>

                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">ë‚ ì§œ ë²”ìœ„</label>
                            <div class="flex space-x-2">
                                <input type="date" value="2025-01-01" class="p-2 border border-gray-300 rounded-lg w-full">
                                <span class="flex items-center text-gray-500">~</span>
                                <input type="date" value="2025-10-30" class="p-2 border border-gray-300 rounded-lg w-full">
                            </div>
                        </div>

                        <div class="flex-grow">
                            <label class="block text-sm font-medium text-gray-700 mb-1">ì´ë¦„/ID ê²€ìƒ‰</label>
                            <input type="text" placeholder="íŠ¹ì • ì°¸ì—¬ì ê²€ìƒ‰" class="w-full p-2 border border-gray-300 rounded-lg">
                        </div>
                    </div>

                    <div class="flex justify-between items-center pt-4">
                        <p class="text-lg font-semibold text-gray-800">
                            í•„í„°ë§ëœ ê²°ê³¼: <span class="text-blue-600">421ê±´</span>
                        </p>
                        <button onclick="alert('í•„í„°ë§ëœ 421ê±´ì˜ ë°ì´í„°ê°€ CSV íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.')" 
                            class="px-6 py-3 text-white font-bold rounded-lg transition duration-150"
                            style="background-color: var(--primary-color);">
                            ğŸ’¾ í•„í„°ë§ëœ ë°ì´í„° ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (CSV)
                        </button>
                    </div>

                </div>

                <div class="mt-8 bg-white p-6 shadow-xl rounded-xl overflow-x-auto">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4">ì‘ë‹µ ëª©ë¡ (ìµœê·¼ìˆœ)</h2>
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">No.</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì´ë¦„</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì—°ë½ì²˜</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì‘ë‹µ ì‹œê°</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">í•µì‹¬ ë‹µë³€ (Q1)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">ì•¡ì…˜</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">1</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">ê¹€ì•¤ë”ìŠ¤</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">010-1234-5678</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">2025-10-30 16:30</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-green-600 font-medium">ë§¤ìš° ë§Œì¡±</td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium"><a href="#" class="text-blue-600 hover:text-blue-900" onclick="alert('ì‘ë‹µ ID 1ì˜ ìƒì„¸ ì •ë³´ë¥¼ ëª¨ë‹¬ë¡œ í‘œì‹œ')">ìƒì„¸ ë³´ê¸°</a></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            `;
        }

        // --- 3. ì„¤ë¬¸ ìƒì„± ë° ê´€ë¦¬ ë·° (QR, ì¼ì •ê´€ë¦¬ í¬í•¨) ---
        function renderSurveyBuilderView() {
            // ... (ì´ì „ì˜ renderSurveyBuilderView HTML ë‚´ìš© ê·¸ëŒ€ë¡œ ì‚½ì…)
            adminContentContainer.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">âœï¸ ì„¤ë¬¸ ìƒì„± ë° ë¬¸í•­ ê´€ë¦¬</h1>
                
                <div class="flex space-x-6">
                    
                    <div class="w-1/4 sticky top-20 h-full bg-white p-4 shadow-xl rounded-xl">
                        <h2 class="text-xl font-bold mb-4 border-b pb-2">ë¬¸í•­ íŒ”ë ˆíŠ¸</h2>
                        <div class="space-y-3">
                            <div class="p-3 bg-gray-50 rounded-lg border cursor-grab hover:bg-gray-100">ğŸ“» ë‹¨ì¼ ì„ íƒ (Radio)</div>
                            <div class="p-3 bg-gray-50 rounded-lg border cursor-grab hover:bg-gray-100">â˜‘ï¸ ë³µìˆ˜ ì„ íƒ (Checkbox)</div>
                            <div class="p-3 bg-gray-50 rounded-lg border cursor-grab hover:bg-gray-100">âœï¸ ì£¼ê´€ì‹ (Text)</div>
                            <div class="p-3 bg-gray-50 rounded-lg border cursor-grab hover:bg-gray-100">â­ï¸ ë³„ì  í‰ê°€ (Rating)</div>
                        </div>
                    </div>

                    <div class="w-1/2 space-y-4">
                        
                        <div class="bg-white p-6 shadow-xl rounded-xl border-t-8" style="border-color: var(--primary-color);">
                            <input type="text" value="[ì„¤ë¬¸ ì œëª©] BTL í˜„ì¥ ë§Œì¡±ë„ ì¡°ì‚¬" class="text-3xl font-bold w-full border-b pb-2 mb-2 focus:outline-none">
                            <textarea class="w-full text-gray-600 resize-none focus:outline-none" rows="2">ì„¤ë¬¸ ì°¸ì—¬ìì—ê²Œ ë³´ì´ëŠ” ì„¤ëª…ì…ë‹ˆë‹¤.</textarea>
                            
                            <div class="flex items-center justify-between mt-4 pt-3 border-t">
                                <span class="text-sm font-semibold text-gray-700 mr-2">ì„¤ë¬¸ ì‹¤í–‰ ìƒíƒœ:</span>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" id="deploy-toggle" value="" class="sr-only peer" checked onchange="updateStatusLabel(this.checked)">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"></div>
                                    <span id="status-label" class="ml-3 text-sm font-medium text-green-600">ì‹¤í–‰ ì¤‘ (Active)</span>
                                </label>
                            </div>
                            
                            <div class="mt-4 p-3 bg-gray-50 rounded-lg">
                                <label class="block text-sm font-semibold text-gray-700 mb-2">ì‹¤í–‰ ì¼ì • ê´€ë¦¬ (ìë™ ë°°í¬/ì¢…ë£Œ)</label>
                                <div class="flex space-x-4 text-sm">
                                    <div class="w-1/2">
                                        <label class="block text-gray-500">ì‹œì‘ ì¼ì‹œ:</label>
                                        <input type="datetime-local" value="2025-11-01T00:00" class="w-full p-2 border rounded-lg">
                                    </div>
                                    <div class="w-1/2">
                                        <label class="block text-gray-500">ì¢…ë£Œ ì¼ì‹œ:</label>
                                        <input type="datetime-local" value="2025-11-03T23:59" class="w-full p-2 border rounded-lg">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="survey-canvas" class="bg-white p-4 shadow-xl rounded-xl space-y-3 min-h-[300px] border border-dashed border-gray-300">
                            <div class="question-block p-4 border rounded-lg shadow-sm hover:shadow-md cursor-pointer" onclick="selectQuestion(this)">
                                <span class="font-semibold text-gray-800">Q1. ê°œì¸ì •ë³´ ìˆ˜ì§‘ ë™ì˜ (ê¸°ë³¸ í¬í•¨)</span>
                            </div>
                            <div class="question-block p-4 border rounded-lg shadow-sm hover:shadow-md cursor-pointer" onclick="selectQuestion(this)">
                                <span class="font-semibold text-gray-800">Q2. í˜„ì¥ ë¶€ìŠ¤ ë°©ë¬¸ ê²½í—˜ì€ ì–´ë– ì…¨ë‚˜ìš”? (ë‹¨ì¼ ì„ íƒ)</span>
                                <div class="text-right text-xs text-blue-600">í•„ìˆ˜ ì‘ë‹µ | [ì‚­ì œ]</div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4 pt-4">
                            <button class="px-6 py-3 bg-gray-300 text-gray-700 font-bold rounded-lg">ì„ì‹œ ì €ì¥</button>
                            <button onclick="handleDeploySurvey()"
                                class="px-6 py-3 text-white font-bold rounded-lg" style="background-color: var(--primary-color);">
                                âœ… ì„¤ë¬¸ ì €ì¥ ë° ë°°í¬
                            </button>
                        </div>
                    </div>

                    <div id="question-settings" class="w-1/4 sticky top-20 h-full bg-white p-4 shadow-xl rounded-xl border border-gray-100">
                        <h2 class="text-xl font-bold mb-4 text-gray-600">ğŸ‘ˆ ë¬¸í•­ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                    </div>

                </div>
            `;
        }

        /**
         * ì„¤ë¬¸ ì‹¤í–‰ ìƒíƒœ ë ˆì´ë¸” ì—…ë°ì´íŠ¸ í•¨ìˆ˜ (í† ê¸€ ì‹œ)
         */
        function updateStatusLabel(isChecked) {
            const label = document.getElementById('status-label');
            if (label) {
                if (isChecked) {
                    label.textContent = 'ì‹¤í–‰ ì¤‘ (Active)';
                    label.classList.remove('text-red-600');
                    label.classList.add('text-green-600');
                } else {
                    label.textContent = 'ë¹„í™œì„±í™” (Inactive)';
                    label.classList.remove('text-green-600');
                    label.classList.add('text-red-600');
                }
            }
        }

        /**
         * ë¬¸í•­ ì„ íƒ ì‹œ ìŠ¤íƒ€ì¼ ì ìš© ë° ì„¤ì • íŒ¨ë„ ì—…ë°ì´íŠ¸ (ë°ëª¨)
         */
        function selectQuestion(element) {
            if (selectedQuestionElement) {
                selectedQuestionElement.classList.remove('selected');
            }
            element.classList.add('selected');
            selectedQuestionElement = element;

            document.getElementById('question-settings').innerHTML = `
                <h2 class="text-xl font-bold mb-4 border-b pb-2">ë¬¸í•­ ì„¤ì •</h2>
                <div class="space-y-3">
                    <label class="block">ì§ˆë¬¸ ë‚´ìš©: <textarea class="w-full border p-2 rounded" rows="3">${element.querySelector('span').textContent}</textarea></label>
                    <label class="block">
                        í•„ìˆ˜ ì‘ë‹µ: <input type="checkbox" ${element.textContent.includes('í•„ìˆ˜') ? 'checked' : ''} class="form-checkbox text-blue-600">
                    </label>
                    <button class="w-full py-2 bg-red-600 text-white rounded mt-4">ë¬¸í•­ ì‚­ì œ</button>
                </div>
            `;
        }

        /**
         * ì„¤ë¬¸ ë°°í¬ ì²˜ë¦¬ ë° QR ì½”ë“œ ìƒì„±/í‘œì‹œ í•¸ë“¤ëŸ¬
         */
        function handleDeploySurvey() {
            const token = localStorage.getItem(ADMIN_TOKEN_KEY);
            if (!token) {
                alert("ì¸ì¦ ì •ë³´ê°€ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.");
                handleAdminLogout();
                return;
            }
            // ì´ ê³³ì—ì„œ ì„œë²„ë¡œ í† í°ê³¼ í•¨ê»˜ ì„¤ë¬¸ ì €ì¥ API í˜¸ì¶œ ë¡œì§ì´ í•„ìš”í•¨.
            // ... (API í˜¸ì¶œ ë° í† í° ì „ì†¡ ë¡œì§ ì¶”ê°€)

            const surveyId = 12345;
            const surveyUrl = `https://your.domain.com/survey.html?id=${surveyId}`;
            const qrCodeImageUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(surveyUrl)}`;
            const isRunning = document.getElementById('deploy-toggle').checked;
            
            // ë°°í¬ ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ (ë°ëª¨)
            const modalHtml = `
                <div class="fixed inset-0 bg-gray-900 bg-opacity-75 z-50 flex justify-center items-center p-4" id="deploy-modal">
                    <div class="bg-white rounded-xl shadow-2xl p-8 max-w-lg w-full text-center">
                        <h2 class="text-3xl font-bold mb-4 ${isRunning ? 'text-green-600' : 'text-orange-600'}">
                            ${isRunning ? 'ğŸ‰ ì„¤ë¬¸ ë°°í¬ ì™„ë£Œ!' : 'ğŸ•’ ì„¤ë¬¸ ë¹„í™œì„±í™”ë¨'}
                        </h2>
                        <p class="text-gray-700 mb-6">ì„¤ë¬¸ì´ ì €ì¥ë˜ì—ˆìœ¼ë©°, ì•„ë˜ QR ì½”ë“œë¥¼ í†µí•´ ${isRunning ? 'ì¦‰ì‹œ ì°¸ì—¬ ê°€ëŠ¥í•©ë‹ˆë‹¤.' : 'í˜„ì¬ëŠ” ì ‘ê·¼ì´ ì œí•œë©ë‹ˆë‹¤.'}</p>
                        
                        <img src="${qrCodeImageUrl}" alt="ì„¤ë¬¸ QR ì½”ë“œ" class="mx-auto my-6 border-4 border-gray-100 rounded-lg">
                        
                        <div class="mb-6">
                            <p class="text-sm font-semibold text-gray-600 mb-2">ì„¤ë¬¸ ê³ ìœ  URL:</p>
                            <div class="flex border rounded-lg overflow-hidden">
                                <input id="survey-url-input" type="text" value="${surveyUrl}" readonly class="flex-grow p-3 text-sm bg-gray-50">
                                <button onclick="navigator.clipboard.writeText(document.getElementById('survey-url-input').value); alert('URLì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');" 
                                        class="bg-blue-600 text-white px-4 hover:bg-blue-700 transition" style="background-color: var(--primary-color);">ë³µì‚¬</button>
                            </div>
                        </div>

                        <p class="text-sm ${isRunning ? 'text-blue-600' : 'text-orange-600'} font-semibold mb-6">
                            ${isRunning ? 'í˜„ì¬ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.' : 'í˜„ì¬ ë¹„í™œì„±í™” ìƒíƒœì…ë‹ˆë‹¤.'} (ì¼ì •ì— ë”°ë¼ ìë™ ë³€ê²½ë©ë‹ˆë‹¤.)
                        </p>

                        <button onclick="document.getElementById('deploy-modal').remove()" 
                                class="px-8 py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-700 transition">ë‹«ê¸°</button>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        // --- 4. ë¸Œëœë“œ/ì»¤ìŠ¤í„°ë§ˆì´ì§• ê´€ë¦¬ ë·° ---
        function renderCustomizationView() {
            // ... (ì´ì „ì˜ renderCustomizationView HTML ë‚´ìš© ê·¸ëŒ€ë¡œ ì‚½ì…)
            adminContentContainer.innerHTML = `
                <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸ¨ ë¸Œëœë“œ ë° ì„¤ë¬¸ ìš”ì†Œ ì»¤ìŠ¤í„°ë§ˆì´ì§•</h1>
                
                <div class="bg-white p-8 shadow-xl rounded-xl space-y-8">
                    
                    <div class="border-b pb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ê´€ë¦¬ì í˜ì´ì§€ ë¸Œëœë”©</h2>
                        <p class="text-sm text-gray-500 mb-4">ê´€ë¦¬ì í˜ì´ì§€ ìƒë‹¨ì— ë…¸ì¶œë˜ëŠ” ë¡œê³  ë° ë©”ì¸ í‚¤ ë¹„ì£¼ì–¼ì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                        <div class="flex space-x-6">
                            <div class="w-1/2">
                                <label class="block text-sm font-medium text-gray-700">ê´€ë¦¬ì ë¡œê³  (Header Logo)</label>
                                <input type="text" value="https://placehold.co/100x30/0099ff/FFFFFF/text=Anders+Logo" placeholder="ë¡œê³  ì´ë¯¸ì§€ URL" class="mt-1 block w-full p-2 border rounded-lg">
                            </div>
                            <div class="w-1/2">
                                <label class="block text-sm font-medium text-gray-700">ë©”ì¸ í‚¤ ë¹„ì£¼ì–¼ (Admin Main KV)</label>
                                <input type="text" value="https://placehold.co/600x150/0099ff/FFFFFF/text=Main+Key+Visual+Image" placeholder="í‚¤ ë¹„ì£¼ì–¼ ì´ë¯¸ì§€ URL" class="mt-1 block w-full p-2 border rounded-lg">
                            </div>
                        </div>
                    </div>

                    <div class="border-b pb-6">
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ì„¤ë¬¸ í˜ì´ì§€ (survey.html) ê³ ì • ìš”ì†Œ</h2>
                        <p class="text-sm text-gray-500 mb-4">ì°¸ì—¬ìê°€ ëª¨ë“  ì„¤ë¬¸ ë‹¨ê³„ì—ì„œ ë³´ê²Œ ë  ìƒí•˜ë‹¨ ì´ë¯¸ì§€ ë° ë¸Œëœë“œ ìƒ‰ìƒì„ ì„¤ì •í•©ë‹ˆë‹¤.</p>
                        <div class="flex space-x-6">
                            <div class="w-1/2">
                                <label class="block text-sm font-medium text-gray-700">ì„¤ë¬¸ Head ì´ë¯¸ì§€ (ìƒë‹¨)</label>
                                <input type="text" value="https://placehold.co/600x60/B0BEC5/FFFFFF/text=Header+Image" placeholder="ì„¤ë¬¸ Head ì´ë¯¸ì§€ URL (var(--survey-head-image))" class="mt-1 block w-full p-2 border rounded-lg">
                            </div>
                            <div class="w-1/2">
                                <label class="block text-sm font-medium text-gray-700">ì„¤ë¬¸ Foot ì´ë¯¸ì§€ (í•˜ë‹¨)</label>
                                <input type="text" value="https://placehold.co/600x40/B0BEC5/FFFFFF/text=Footer+Image" placeholder="ì„¤ë¬¸ Foot ì´ë¯¸ì§€ URL (var(--survey-foot-image))" class="mt-1 block w-full p-2 border rounded-lg">
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <label class="block text-sm font-medium text-gray-700">ë¸Œëœë“œ ì£¼ ìƒ‰ìƒ (Primary Color)</label>
                            <div class="flex items-center space-x-2">
                                <input type="color" value="#0099ff" class="w-10 h-10 border rounded-lg">
                                <input type="text" value="#0099ff" class="w-1/2 p-2 border rounded-lg">
                                <p class="text-xs text-gray-500">ì„¤ë¬¸ ì§„í–‰ ë°”, ë²„íŠ¼ ìƒ‰ìƒ ë“±ì— ì‚¬ìš©ë©ë‹ˆë‹¤. (--primary-color)</p>
                            </div>
                        </div>
                    </div>

                    <div>
                        <h2 class="text-2xl font-bold text-gray-800 mb-4">ì„¤ë¬¸ ì™„ë£Œ í˜ì´ì§€ ë¬¸êµ¬</h2>
                        <p class="text-sm text-gray-500 mb-4">ì„¤ë¬¸ ì™„ë£Œ í›„ ì°¸ì—¬ìì—ê²Œ ë…¸ì¶œë˜ëŠ” ìµœì¢… ì•ˆë‚´ ë©”ì‹œì§€ì…ë‹ˆë‹¤.</p>
                        
                        <label class="block text-sm font-medium text-gray-700">ê°ì‚¬ íƒ€ì´í‹€</label>
                        <input type="text" value="ì°¸ì—¬í•´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤!" class="mt-1 block w-full p-2 border rounded-lg mb-4">

                        <label class="block text-sm font-medium text-gray-700">ì£¼ìš” ì•ˆë‚´ ë©”ì‹œì§€</label>
                        <textarea id="thankyou-message" rows="4" class="mt-1 block w-full p-2 border rounded-lg">ê·€í•˜ì˜ ì†Œì¤‘í•œ ì˜ê²¬ì´ ì´ë²¤íŠ¸ ìš´ì˜ ë° ì œí’ˆ ê°œë°œì— í° ë„ì›€ì´ ë©ë‹ˆë‹¤. ì°¸ì—¬í•´ì£¼ì‹  ë¶„ë“¤ê»˜ëŠ” ì¶”ì²¨ì„ í†µí•´ ì†Œì •ì˜ ê²½í’ˆì´ ì œê³µë  ì˜ˆì •ì´ë©°, ë‹¹ì²¨ìëŠ” ê°œë³„ ì—°ë½ë“œë¦´ ì˜ˆì •ì…ë‹ˆë‹¤.</textarea>
                    </div>

                    <div class="flex justify-end pt-4">
                        <button onclick="alert('ë¸Œëœë“œ ì»¤ìŠ¤í„°ë§ˆì´ì§• ì„¤ì •ì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì–´ ëª¨ë“  ì„¤ë¬¸ì— ë°˜ì˜ë˜ì—ˆìŠµë‹ˆë‹¤.')" 
                            class="px-6 py-3 text-white font-bold rounded-lg transition duration-150"
                            style="background-color: var(--primary-color);">
                            ğŸ’¾ ë³€ê²½ ì‚¬í•­ ì €ì¥
                        </button>
                    </div>
                </div>
            `;
        }

    </script>
</body>
</html>